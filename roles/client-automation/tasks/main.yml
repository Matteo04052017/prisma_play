## set up the compression
- name: Ensure rsync data path directory
  file:
    path: '{{rsync_data_path}}'
    state: directory
    mode: 0755
  become: yes

- name: Copy up compress.py file
  copy:
    src: "{{ role_path }}/code/compress.py"
    dest: "/usr/local/bin/compress.py"

- name: Add cron job for compression
  cron:
    name: "Compress prisma data at {{data_path}}"
    minute: "30"
    hour: "*"
    day: "*"
    month: "*"
    weekday: "*"
    user: "root"
    job: "python3 /usr/local/bin/compress.py -r {{data_path}} -o {{rsync_data_path}}"
    cron_file: "/etc/crontab"
  become: yes

